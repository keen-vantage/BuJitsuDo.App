!function(){"use strict";var t,e=function(){},n=20,i=sessionStorage,r={},o={slideIn:"slide-out",slideOut:"slide-in",fade:"fade"},a={bartab:".bar-tab",barnav:".bar-nav",barfooter:".bar-footer",barheadersecondary:".bar-header-secondary"},d=function(t,e){m.id=t.id,e&&(t=u(t.id)),i[t.id]=JSON.stringify(t),window.history.replaceState(t.id,t.title,t.url),r[t.id]=document.body.cloneNode(!0)},s=function(){var t=m.id,e=JSON.parse(i.cacheForwardStack||"[]"),r=JSON.parse(i.cacheBackStack||"[]");for(r.push(t);e.length;)delete i[e.shift()];for(;r.length>n;)delete i[r.shift()];window.history.pushState(null,"",i[m.id].url),i.cacheForwardStack=JSON.stringify(e),i.cacheBackStack=JSON.stringify(r)},c=function(t,e){var n="forward"===e,r=JSON.parse(i.cacheForwardStack||"[]"),o=JSON.parse(i.cacheBackStack||"[]"),a=n?o:r,d=n?r:o;m.id&&a.push(m.id),d.pop(),i.cacheForwardStack=JSON.stringify(r),i.cacheBackStack=JSON.stringify(o)},u=function(t){return JSON.parse(i[t]||null)||{}},l=function(e){var n=y(e.target);if(!(!n||e.which>1||e.metaKey||e.ctrlKey||t||location.protocol!==n.protocol||location.host!==n.host||!n.hash&&/#/.test(n.href)||n.hash&&n.href.replace(n.hash,"")===location.href.replace(location.hash,"")||"push"===n.getAttribute("data-ignore")))return n},f=function(t){var e=l(t);e&&(t.preventDefault(),m({url:e.href,hash:e.hash,timeout:e.getAttribute("data-timeout"),transition:e.getAttribute("data-transition")}))},h=function(t){var e,n,d,s,l,f,h,v,w=t.state;if(w&&i[w]){if(l=m.id<w?"forward":"back",c(w,l),d=u(w),s=r[w],d.title&&(document.title=d.title),"back"===l?(h=JSON.parse("back"===l?i.cacheForwardStack:i.cacheBackStack),v=u(h[h.length-1])):v=d,"back"===l&&!v.id)return m.id=w;if(f="back"===l?o[v.transition]:v.transition,!s)return m({id:d.id,url:d.url,title:d.title,timeout:d.timeout,transition:f,ignorePush:!0});if(v.transition){d=g(d,".content",s.cloneNode(!0));for(e in a)a.hasOwnProperty(e)&&(n=document.querySelector(a[e]),d[e]?p(d[e],n):n&&n.parentNode.removeChild(n))}p((d.contents||s).cloneNode(!0),document.querySelector(".content"),f),m.id=w,document.body.offsetHeight}},m=function(t){var n,i=m.xhr;t.container=t.container||t.transition?document.querySelector(".content"):document.body;for(n in a)a.hasOwnProperty(n)&&(t[n]=t[n]||document.querySelector(a[n]));i&&i.readyState<4&&(i.onreadystatechange=e,i.abort()),i=new XMLHttpRequest,i.open("GET",t.url,!0),i.setRequestHeader("X-PUSH","true"),i.onreadystatechange=function(){t._timeout&&clearTimeout(t._timeout),4===i.readyState&&(200===i.status?v(i,t):w(t.url))},m.id||d({id:+new Date,url:window.location.href,title:document.title,timeout:t.timeout,transition:null}),t.timeout&&(t._timeout=setTimeout(function(){i.abort("timeout")},t.timeout)),i.send(),i.readyState&&!t.ignorePush&&s()},v=function(t,e){var n,i,r=L(t,e);if(!r.contents)return b(e.url);if(r.title&&(document.title=r.title),e.transition)for(n in a)a.hasOwnProperty(n)&&(i=document.querySelector(a[n]),r[n]?p(r[n],i):i&&i.parentNode.removeChild(i));p(r.contents,e.container,e.transition,function(){d({id:e.id||+new Date,url:r.url,title:r.title,timeout:e.timeout,transition:e.transition},e.id),S()}),!e.ignorePush&&window._gaq&&_gaq.push(["_trackPageview"]),!e.hash},w=function(t){throw new Error("Could not get: "+t)},p=function(t,e,n,i){var r,o,a;if(n?(r=/in$/.test(n),"fade"===n&&(e.classList.add("in"),e.classList.add("fade"),t.classList.add("fade")),/slide/.test(n)&&(t.classList.add("sliding-in",r?"right":"left"),t.classList.add("sliding"),e.classList.add("sliding")),e.parentNode.insertBefore(t,e)):e?e.innerHTML=t.innerHTML:t.classList.contains("content")?document.body.appendChild(t):document.body.insertBefore(t,document.querySelector(".content")),n||i&&i(),"fade"===n){e.offsetWidth,e.classList.remove("in");var d=function(){e.removeEventListener("webkitTransitionEnd",d),t.classList.add("in"),t.addEventListener("webkitTransitionEnd",s)},s=function(){t.removeEventListener("webkitTransitionEnd",s),e.parentNode.removeChild(e),t.classList.remove("fade"),t.classList.remove("in"),i&&i()};e.addEventListener("webkitTransitionEnd",d)}if(/slide/.test(n)){var c=function(){t.removeEventListener("webkitTransitionEnd",c),t.classList.remove("sliding","sliding-in"),t.classList.remove(a),e.parentNode.removeChild(e),i&&i()};e.offsetWidth,a=r?"right":"left",o=r?"left":"right",e.classList.add(o),t.classList.remove(a),t.addEventListener("webkitTransitionEnd",c)}},S=function(){var t=new CustomEvent("push",{detail:{state:u(m.id)},bubbles:!0,cancelable:!0});window.dispatchEvent(t)},y=function(t){for(var e,n=document.querySelectorAll("a");t&&t!==document;t=t.parentNode)for(e=n.length;e--;)if(n[e]===t)return t},b=function(t){window.history.replaceState(null,"","#"),window.location.replace(t)},g=function(t,e,n){var i,r={};for(i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return Object.keys(a).forEach(function(t){var e=n.querySelector(a[t]);e&&e.parentNode.removeChild(e),r[t]=e}),r.contents=n.querySelector(e),r},L=function(t,e){var n,i,r={},o=t.responseText;if(r.url=e.url,!o)return r;/<html/i.test(o)?(n=document.createElement("div"),i=document.createElement("div"),n.innerHTML=o.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0],i.innerHTML=o.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]):(n=i=document.createElement("div"),n.innerHTML=o),r.title=n.querySelector("title");var a="innerText"in r.title?"innerText":"textContent";return r.title=r.title&&r.title[a].trim(),e.transition?r=g(r,".content",i):r.contents=i,r};window.addEventListener("touchstart",function(){t=!1}),window.addEventListener("touchmove",function(){t=!0}),window.addEventListener("touchend",f),window.addEventListener("click",function(t){l(t)&&t.preventDefault()}),window.addEventListener("popstate",h),window.PUSH=m}();